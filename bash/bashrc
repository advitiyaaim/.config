#      .-.     .-.     .-.     .-.     .-.     .-.
# `._.'   `._.'   `._.'   `._.'   `._.'   `._.'   `
#
# github.com/rafi ~/.bashrc config

# If not running interactively, don't do anything
[[ $- != *i* ]] && return

# https://wiki.archlinux.org/index.php/RTorrent
# Ctrl-s is often used for terminal control to stop screen output while Ctrl-q is used to
# start it. These mappings may interfere with rTorrent. Check to see if these terminal
# options are bound to a mapping:
#   $ stty -a
# Remove the ^S ^Q mappings
stty stop undef
stty start undef

# Bash options
shopt -s cdspell        # autocorrects cd misspellings
shopt -s checkwinsize   # update the value of LINES and COLUMNS after each command if altered
shopt -s cmdhist        # save multi-line commands in history as single line
shopt -s dotglob        # include dotfiles in pathname expansion
shopt -s expand_aliases # expand aliases
shopt -s extglob        # enable extended pattern-matching features
shopt -s histreedit     # Add failed commands to the bash history
shopt -s histappend     # Append each session's history to $HISTFILE
shopt -s autocd         # Autocd

export HISTSIZE=2000
export HISTFILESIZE=50000
export HISTFILE="$XDG_CACHE_HOME/bash_history"
export HISTCONTROL=ignoreboth
export VISUAL=vim
export EDITOR="$VISUAL"
export PAGER=less
export BROWSER="/usr/bin/google-chrome-stable"

if [[ "$OSTYPE" == "darwin"* ]]; then
	export BROWSER="open"
	# OSX bash-completion isn't loaded automatically.
	# Archlinux: https://wiki.archlinux.org/index.php/Bash#Configuration_files
	if [ -f "$PREFIX/etc/profile.d/bash_completion.sh" ]; then
		source "$PREFIX/etc/profile.d/bash_completion.sh"
	fi
fi

# Source all my custom aliases
source "$XDG_CONFIG_HOME/bash/aliases"

# Source all extra functions
for f in $XDG_CONFIG_HOME/bash/functions.d/*; do source "$f"; done
unset f

# Git prompt helpers
export GIT_PS1_SHOWDIRTYSTATE=1
export GIT_PS1_SHOWSTASHSTATE=1
export GIT_PS1_SHOWCOLORHINTS=0
if [ -f "$PREFIX/share/git/git-prompt.sh" ]; then
	source "$PREFIX/share/git/git-prompt.sh"
fi

# Load Docker bash completion
# https://github.com/docker/docker/blob/master/contrib
if [ -f "$HOME/.local/share/docker/bash_completion" ]; then
	source "$HOME/.local/share/docker/bash_completion"
fi

# Load mpc bash completion
if [ -f "$PREFIX/share/doc/mpc/mpc-completion.bash" ]; then
	source "$PREFIX/share/doc/mpc/mpc-completion.bash"
fi

# If this is an xterm/rxvt/screen/tmux set the window title to user@host:dir
case "$TERM" in
xterm*|rxvt*|screen*)
	# Show a "user@host: /dir" in terminal title
	PROMPT_COMMAND='history -a; echo -ne "\033]0;${USER}@${HOSTNAME}: ${PWD}\007"'
	;;
*)
	;;
esac

# https://github.com/rupa/z
# Must be loaded _after_ setting PROMPT_COMMAND
if [ -f "$PREFIX/lib/z.sh" ]; then
	source "$PREFIX/lib/z.sh"
fi

# Load my symlinked command prompt theme
source "$XDG_CONFIG_HOME/bash/themes/current"

# Load directory and file colors for GNU ls
eval $(dircolors -b "$XDG_CONFIG_HOME/bash/dircolors")

# vim: set ts=2 sw=2 tw=80 noet :
